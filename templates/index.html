{% extends "_base.html" %}
{% block body %}
<div class="container">
    <div class="header">
        <div class="header2">
            <h1>{{ identity.name }}</h1>
            {% include "_contact.html" %}
        </div>
    </div>
    <div id="main">
        {% include "_employment.html" %}
        {% include "_education.html" %}
        {% include "_projects.html" %}
        {% include "_skills.html" %}
    </div>
    <button id="print-button" class="btn" onclick="window.print()">Download</button>
    <div id="timestamps">
        <span>Accessed <span id="access_date"></span>.</span>
        <span id="updated_at"></span>
        <span>ceasarbautista.com/resume</span>
    </div>
</div>
<script>
    var printDate = function (d) {
        // month is 0-indexed
        var month = d.getMonth() + 1;
        var day = d.getDate();
        var year = d.getFullYear();
        return month + "/" + day + "/" + year;
    }
    $('#access_date').text(printDate(new Date()));

    var getRepo = function(repo_name, callback) {
        var url = (
        "https://api.github.com/repos/Ceasar/" + repo_name + "?callback=?");
        $.getJSON(url, callback);
    }

    getRepo("resume", function(resp) {
        if (resp.meta.status !== 403) {
            $("#updated_at").text(
                "Updated " + printDate(new Date(resp.data.updated_at))) + ".";
        }
    });

    var projects = [
    {% for project in projects %}
        "{{project.name}}"{% if not loop.last %},{% endif %}
    {%endfor %}
    ];
    var forks_count, stargazers_count;
    $.each(projects, function(index, project) {
        getRepo(project, function(resp) {
            if (resp.meta.status !== 403) {
                forks_count = resp.data.forks_count || 0;
                stargazers_count = resp.data.stargazers_count || 0;
                $("#" + project + " .meta").text(
                    "Forks: " + forks_count + ", Stars: " + stargazers_count
                );
            }
        });
    });
</script>
{% endblock %}
